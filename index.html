<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Validade ‚Ä¢ Cat Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Parisienne&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink-50:#fff0f6; --pink-100:#ffe4ef; --pink-200:#ffcfe2; --pink-300:#ffb3d1; --pink-400:#ff89b6; --pink-500:#ff69b4; 
      --gold:#ffd700; --gold-2:#f6c453; --text:#5a4956; --white:#fff; --shadow:0 10px 24px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(135deg,var(--pink-50),var(--pink-100));
      font-family:'Quicksand',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
    }
    /* Sutilas patinhas no fundo */
    body:before{content:""; position:fixed; inset:0; pointer-events:none; opacity:.07; background-image:
      radial-gradient(circle at 20px 20px, #ff8dc4 2px, transparent 3px),
      radial-gradient(circle at 35px 35px, #ff8dc4 1.5px, transparent 3px);
      background-size:60px 60px;}

    
    @keyframes twinkle{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    header{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.1) blur(8px);
      background:linear-gradient(90deg, rgba(255,255,255,.85), rgba(255,240,245,.85)); border-bottom:2px solid #ffd8ea;
    }
    .container{max-width:1100px; margin:0 auto; padding:18px;}

    .brand{display:flex; align-items:center; gap:14px}
    .brand .logo{width:56px; height:56px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff 0 35%, #ffe2f0 36% 100%);
                 position:relative; box-shadow:var(--shadow);}
    .brand .logo:before{content:""; position:absolute; inset:10px; border-radius:50%; background:linear-gradient(135deg,#ffd70055,#ffd70015);
                        box-shadow:inset 0 0 0 2px #ffd70055;}
    .brand h1{font-family:'Parisienne',cursive; font-size:34px; line-height:1; margin:0; color:var(--pink-500);
              text-shadow:0 0 10px rgba(255,215,0,.5)}
    .brand small{display:block; margin-top:2px; font-size:12px; color:#8b6d80}

    .actions{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end}
    .btn{appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:14px; font-weight:700; 
         background:linear-gradient(45deg,var(--pink-400), var(--gold)); color:#7d2451; box-shadow:var(--shadow);
         transition:transform .2s ease, box-shadow .2s ease;}
    .btn:hover{transform:translateY(-1px); box-shadow:0 14px 28px rgba(0,0,0,.12)}
    .btn.ghost{background:var(--white); border:2px solid #ffd8ea; color:#a05377}

    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}}

    .card{background:var(--white); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); position:relative}
    .card h3{margin:0 0 12px; color:#a03c6b}
    .kpis{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
    @media (max-width:720px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{background:linear-gradient(180deg,#fff, #fff5fa); border:1px solid #ffd8ea; border-radius:16px; padding:14px; text-align:center}
    .kpi .num{font-weight:800; font-size:26px; color:#7d2451}
    .kpi .tag{font-size:12px; color:#9a6f86}

    .form-row{display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:10px}
    @media (max-width:720px){.form-row{grid-template-columns:1fr 1fr;}}
    label{font-size:12px; color:#9a6f86; font-weight:700}
    input, select, textarea{width:100%; padding:10px 12px; border:2px solid #ffd8ea; border-radius:12px; background:#fff; color:var(--text);
                            outline:none; transition:border-color .2s ease}
    input:focus,select:focus,textarea:focus{border-color:var(--pink-400)}
    .form-actions{display:flex; gap:10px; margin-top:10px}

    .toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .toolbar .search{flex:1; min-width:200px}

    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:8px 12px; border-radius:999px; border:2px solid #ffd8ea; background:#fff; cursor:pointer; font-weight:700; color:#a05377}
    .tab.active{background:linear-gradient(45deg,#ffddee,#fff3f8); box-shadow:inset 0 0 0 2px #ffc0db}

    .list{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px}
    @media (max-width:900px){.list{grid-template-columns:1fr}}

    .item{position:relative; padding:14px; border-radius:16px; border:1.5px solid #ffd8ea; background:linear-gradient(180deg,#fff,#fff6fb);} 
    .item:hover{transform:translateY(-1px); box-shadow:var(--shadow)}
    .item-head{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .name{font-weight:800; color:#7d2451; display:flex; align-items:center; gap:8px}
    .cat{font-size:22px}

    .badges{display:flex; gap:6px; flex-wrap:wrap}
    .badge{font-size:11px; font-weight:800; padding:4px 8px; border-radius:999px}
    .b-ok{background:#e9fff0; border:1px solid #b7f0cc; color:#2f7e54}
    .b-warn{background:#fff8e6; border:1px solid #ffd27a; color:#a35b00}
    .b-exp{background:#ffe7ea; border:1px solid #ff9fb1; color:#a8002f}
    .b-low{background:#fff1f1; border:1px solid #ffc7c7; color:#b64747}

    .meta{display:flex; gap:10px; flex-wrap:wrap; color:#8b6d80; font-size:13px; margin-top:8px}

    .item-actions{display:flex; gap:8px; margin-top:10px}
    .btn.sm{padding:6px 10px; border-radius:10px; font-size:12px}
    .btn.gray{background:#ffffff; border:2px solid #f0c2d7; color:#9a6f86}
    .btn.red{background:linear-gradient(45deg,#ff9fb1,#ff6b81); color:#fff}

    /* Se√ß√£o de urg√™ncia */
    .alerts{display:grid; gap:10px}
    .alert-item{background:linear-gradient(180deg,#fff7f0,#fff); border:1.5px dashed #ffd27a; border-radius:16px; padding:12px}

    /* Modal */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,192,203,.35); backdrop-filter:blur(4px); z-index:100}
    .modal.show{display:flex}
    .modal-card{width:min(560px,94vw); background:#fff; border-radius:18px; padding:16px; box-shadow:var(--shadow); position:relative}
    .modal-card h4{margin:0 0 10px; color:#a03c6b}
    .modal-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:10px}

    /* Rodap√© */
    footer{margin:32px 0 18px; text-align:center; color:#8b6d80; font-size:12px}
  </style>
</head>
<body>
  <header class="glitter">
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div class="brand">
        <div>
          <h1>Controle de validade</h1>
        </div>
      </div>
      <div class="actions">
        <button class="btn ghost" id="notifyBtn">üîî Notifica√ß√µes</button>
        <button class="btn ghost" id="exportBtn">‚¨áÔ∏è Exportar CSV</button>
        <label class="btn ghost" for="importFile" style="cursor:pointer">‚¨ÜÔ∏è Importar CSV</label>
        <input id="importFile" type="file" accept=".csv" style="display:none" />
      </div>
    </div>
  </header>

  <main class="container" style="margin-top:18px;">
    <div class="grid">
      <!-- Coluna esquerda: formul√°rio + alertas -->
      <section class="card glitter">
        <h3>üê± Adicionar produto</h3>
        <form id="formAdd">
          <div class="form-row">
            <div>
              <label>Nome</label>
              <input required id="name" placeholder="Ex.: Shampoo" />
            </div>
            <div>
              <label>Quantidade</label>
              <input required id="qty" type="number" min="1" value="1" />
            </div>
            <div>
              <label>Categoria</label>
              <select id="category">
                <option>Geral</option>
                <option>Shampoo</option>
                <option>Condicionador</option>
                <option>Hidrata√ß√£o</option>
                <option>Finalizador</option>
                <option>T√¥nicos</option>
                <option>√ìleos</option>
                <option>Tintas</option>
                <option>Kits</option>
              </select>
            </div>
            <div>
              <label>Validade</label>
              <input required id="expiry" type="date" />
            </div>
          </div>
          <div style="margin-top:10px">
            <label>Observa√ß√µes (opcional)</label>
            <textarea id="notes" rows="2" placeholder="Lote, marca..."></textarea>
          </div>
          <div class="form-actions">
            <button class="btn" type="submit">‚ûï Adicionar</button>
            <button class="btn ghost" type="reset">Limpar</button>
          </div>
        </form>
      </section>

      <section class="card">
        <h3>‚ö†Ô∏è Produtos perto do fim da validade</h3>
        <div id="alerts" class="alerts"></div>
      </section>
    </div>

    <section class="card glitter" style="margin-top:18px;">
      <div class="toolbar" style="margin-bottom:10px;">
        <div class="tabs" id="tabs">
          <button class="tab active" data-filter="all">Todos</button>
          <button class="tab" data-filter="ok">V√°lidos</button>
          <button class="tab" data-filter="near">Perto (4 meses)</button>
          <button class="tab" data-filter="expired">Vencidos</button>
        </div>
        <input class="search" id="search" placeholder="Buscar por nome ou categoria..." />
        <select id="sort">
          <option value="expiryAsc">Ordenar: mais pr√≥ximos primeiro</option>
          <option value="nameAsc">Ordenar: nome (A‚ÜíZ)</option>
          <option value="qtyDesc">Ordenar: maior quantidade</option>
        </select>
      </div>

      <div class="kpis" style="margin-bottom:10px;">
        <div class="kpi"><div class="num" id="kpiTotal">0</div><div class="tag">Produtos</div></div>
        <div class="kpi"><div class="num" id="kpiNear">0</div><div class="tag">Perto de vencer</div></div>
        <div class="kpi"><div class="num" id="kpiExp">0</div><div class="tag">Vencidos</div></div>
        <div class="kpi"><div class="num" id="kpiOk">0</div><div class="tag">V√°lidos</div></div>
      </div>

      <div id="list" class="list"></div>
    </section>
  </main>

  <div id="modal" class="modal">
    <div class="modal-card glitter">
      <h4>‚úèÔ∏è Editar produto</h4>
      <form id="formEdit">
        <input type="hidden" id="editId" />
        <div class="form-row">
          <div>
            <label>Nome</label>
            <input id="editName" required />
          </div>
          <div>
            <label>Quantidade</label>
            <input id="editQty" type="number" min="1" required />
          </div>
          <div>
            <label>Categoria</label>
            <select id="editCategory">
             <option>Geral</option>
                <option>Shampoo</option>
                <option>Condicionador</option>
                <option>Hidrata√ß√£o</option>
                <option>Finalizador</option>
                <option>T√¥nicos</option>
                <option>√ìleos</option>
                <option>Tintas</option>
                <option>Kits</option>
            </select>
          </div>
          <div>
            <label>Validade</label>
            <input id="editExpiry" type="date" required />
          </div>
        </div>
        <div style="margin-top:10px">
          <label>Observa√ß√µes</label>
          <textarea id="editNotes" rows="2"></textarea>
        </div>
        <div class="modal-actions">
          <button class="btn" type="submit">üíæ Salvar</button>
          <button class="btn gray" type="button" id="closeModal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
<footer>  
</footer>

  <script>
    // ===== Utilidades de data
    const MS_PER_DAY = 1000*60*60*24;
    const toISO = (d)=> new Date(d).toISOString().slice(0,10);
    const daysLeft = (isoDate)=> Math.ceil((new Date(isoDate) - new Date())/MS_PER_DAY);
    const fmtDays = (n)=> n<0?`Vencido h√° ${Math.abs(n)} dia${Math.abs(n)===1?'':'s'}`: n===0? 'Vence hoje' : `Faltam ${n} dia${n===1?'':'s'}`;

    // ===== Estado
    const storageKey = 'catshelf.products.v1';
    let products = JSON.parse(localStorage.getItem(storageKey) || '[]');

    // ===== Persist√™ncia
    function save(){ localStorage.setItem(storageKey, JSON.stringify(products)); }

    // ===== CRUD
    function addProduct(p){ products.push({...p, id: crypto.randomUUID()}); save(); render(); }
    function updateProduct(id, patch){ products = products.map(p=> p.id===id? {...p, ...patch}: p); save(); render(); }
    function removeProduct(id){ products = products.filter(p=> p.id!==id); save(); render(); }

    // ===== Filtros e ordena√ß√£o
    let currentFilter = 'all';
    let currentSearch = '';
    let currentSort = 'expiryAsc';

    function statusOf(p){
      const d = daysLeft(p.expiry);
      if(d < 0) return 'expired';
      if(d <= 7) return 'near';
      return 'ok';
    }

    function sortFn(a,b){
      if(currentSort==='nameAsc') return a.name.localeCompare(b.name, 'pt-BR', {sensitivity:'base'});
      if(currentSort==='qtyDesc') return (b.qty||0)-(a.qty||0) || a.name.localeCompare(b.name);
      // expiryAsc
      return daysLeft(a.expiry) - daysLeft(b.expiry);
    }

    function filterList(p){
      const st = statusOf(p);
      const match = (p.name+" "+p.category).toLowerCase().includes(currentSearch);
      if(!match) return false;
      if(currentFilter==='all') return true;
      if(currentFilter==='ok') return st==='ok';
      if(currentFilter==='near') return st==='near';
      if(currentFilter==='expired') return st==='expired';
      return true;
    }

    // ===== Render KPIs
    function renderKPIs(list){
      const total = products.length;
      const near = products.filter(p=> statusOf(p)==='near').length;
      const exp = products.filter(p=> statusOf(p)==='expired').length;
      const ok = total - near - exp;
      document.getElementById('kpiTotal').textContent = total;
      document.getElementById('kpiNear').textContent = near;
      document.getElementById('kpiExp').textContent = exp;
      document.getElementById('kpiOk').textContent = ok;
    }

    // ===== Render Alerts
    function renderAlerts(){
      const wrap = document.getElementById('alerts');
      const items = products.filter(p=> ['near','expired'].includes(statusOf(p)))
                            .sort((a,b)=> daysLeft(a.expiry) - daysLeft(b.expiry));
      wrap.innerHTML = '';
      if(items.length===0){
        wrap.innerHTML = '<div class="alert-item">‚úÖ Sem produtos urgentes no momento.</div>';
        return;
      }
      for(const p of items){
        const d = daysLeft(p.expiry);
        const badge = d<0?'<span class="badge b-exp">Vencido</span>':'<span class="badge b-warn">Perto</span>';
        const el = document.createElement('div');
        el.className = 'alert-item';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
            <div><span class="cat">üêæ</span> <strong>${p.name}</strong> ‚Äî ${fmtDays(d)} (validade: ${p.expiry})</div>
            <div class="badges">${badge}${p.qty<=1?'<span class="badge b-low">Estoque baixo</span>':''}</div>
        </div>`;
        wrap.appendChild(el);
      }
    }

    // ===== Render List
    function renderList(){
      const list = document.getElementById('list');
      const filtered = products.filter(filterList).sort(sortFn);
      list.innerHTML = '';
      for(const p of filtered){
        const d = daysLeft(p.expiry); const st = statusOf(p);
        const item = document.createElement('div'); item.className='item';
        const badges = [
          st==='ok'?'<span class="badge b-ok">V√°lido</span>': '',
          st==='near'?'<span class="badge b-warn">Perto</span>': '',
          st==='expired'?'<span class="badge b-exp">Vencido</span>': '',
          p.qty<=1?'<span class="badge b-low">Estoque baixo</span>': ''
        ].join('');
        item.innerHTML = `
          <div class="item-head">
            <div class="name"><span class="cat">üê±</span>${p.name}</div>
            <div class="badges">${badges}</div>
          </div>
          <div class="meta">
            <div>Categoria: <strong>${p.category||'‚Äî'}</strong></div>
            <div>Qtd: <strong>${p.qty}</strong></div>
            <div>Validade: <strong>${p.expiry}</strong></div>
            <div>${fmtDays(d)}</div>
          </div>
          ${p.notes?`<div class="meta">üìù ${p.notes}</div>`:''}
          <div class="item-actions">
            <button class="btn sm gray" data-edit="${p.id}">‚úèÔ∏è Editar</button>
            <button class="btn sm red" data-del="${p.id}">üóëÔ∏è Remover</button>
          </div>
        `;
        list.appendChild(item);
      }
      // Bind actions
      list.querySelectorAll('[data-edit]').forEach(b=> b.addEventListener('click',()=> openEdit(b.dataset.edit)));
      list.querySelectorAll('[data-del]').forEach(b=> b.addEventListener('click',()=> delConfirm(b.dataset.del)));
    }

    function render(){
      renderKPIs();
      renderAlerts();
      renderList();
    }

    // ===== Form Add
    document.getElementById('formAdd').addEventListener('submit', (e)=>{
      e.preventDefault();
      const p = {
        name: document.getElementById('name').value.trim(),
        qty: Math.max(1, parseInt(document.getElementById('qty').value||'1')), 
        category: document.getElementById('category').value,
        expiry: document.getElementById('expiry').value,
        notes: document.getElementById('notes').value.trim()
      };
      if(!p.name || !p.expiry) return;
      addProduct(p);
      e.target.reset();
      // Notifica√ß√£o suave ao adicionar
      ping('Produto adicionado', `${p.name} cadastrado com validade ${p.expiry}`);
    });

    // ===== Tabs / Filtro
    document.getElementById('tabs').addEventListener('click', (e)=>{
      if(e.target.classList.contains('tab')){
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        e.target.classList.add('active');
        currentFilter = e.target.dataset.filter;
        render();
      }
    });

    // ===== Busca
    document.getElementById('search').addEventListener('input', (e)=>{
      currentSearch = e.target.value.trim().toLowerCase(); render();
    });

    // ===== Ordena√ß√£o
    document.getElementById('sort').addEventListener('change', (e)=>{ currentSort = e.target.value; render(); });

    // ===== Editar (Modal)
    const modal = document.getElementById('modal');
    const formEdit = document.getElementById('formEdit');
    document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.remove('show'));
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('show'); });

    function openEdit(id){
      const p = products.find(x=> x.id===id); if(!p) return;
      document.getElementById('editId').value = p.id;
      document.getElementById('editName').value = p.name;
      document.getElementById('editQty').value = p.qty;
      document.getElementById('editCategory').value = p.category;
      document.getElementById('editExpiry').value = p.expiry;
      document.getElementById('editNotes').value = p.notes||'';
      modal.classList.add('show');
    }

    formEdit.addEventListener('submit', (e)=>{
      e.preventDefault();
      const id = document.getElementById('editId').value;
      const patch = {
        name: document.getElementById('editName').value.trim(),
        qty: Math.max(1, parseInt(document.getElementById('editQty').value||'1')),
        category: document.getElementById('editCategory').value,
        expiry: document.getElementById('editExpiry').value,
        notes: document.getElementById('editNotes').value.trim()
      };
      updateProduct(id, patch);
      modal.classList.remove('show');
      ping('Produto atualizado', `${patch.name} agora vence em ${patch.expiry}`);
    });

    // ===== Remover
    function delConfirm(id){
      const p = products.find(x=> x.id===id); if(!p) return;
      if(confirm(`Remover ${p.name}? Esta a√ß√£o n√£o poder√° ser desfeita.`)){
        removeProduct(id);
        ping('Removido', `${p.name} foi removido da lista`);
      }
    }

    // ===== Exportar/Importar CSV
    function toCSV(){
      const header = ['id','name','qty','category','expiry','notes'];
      const rows = products.map(p=> header.map(h=> (''+(p[h]??'')).replaceAll('"','""')));
      const csv = [header.join(','), ...rows.map(r=> r.map(c=> `"${c}"`).join(','))].join('\n');
      return csv;
    }

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([toCSV()], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='catshelf-produtos.csv'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('importFile').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        const text = reader.result; const lines = text.split(/\r?\n/).filter(Boolean);
        const header = lines.shift().split(',').map(h=> h.replaceAll('"','').trim());
        const idx = Object.fromEntries(header.map((h,i)=>[h,i]));
        const parsed = lines.map(line=>{
          const cols = line.match(/\"([^\"]*)\"|([^,]+)/g)?.map(c=> c.replace(/^\"|\"$/g,'').replaceAll('""','"'))||[];
          return {
            id: cols[idx.id]||crypto.randomUUID(),
            name: cols[idx.name]||'',
            qty: parseInt(cols[idx.qty]||'1'),
            category: cols[idx.category]||'Geral',
            expiry: cols[idx.expiry]||toISO(new Date()),
            notes: cols[idx.notes]||''
          };
        });
        products = parsed; save(); render(); ping('Importado', 'Planilha importada com sucesso!');
      };
      reader.readAsText(file);
      e.target.value='';
    });

    // ===== Notifica√ß√µes (opcional)
    function ping(title, body){
      if(!('Notification' in window)) return;
      if(Notification.permission==='granted') new Notification(title, {body});
    }
    document.getElementById('notifyBtn').addEventListener('click', ()=>{
      if(!('Notification' in window)) { alert('Seu navegador n√£o suporta notifica√ß√µes.'); return; }
      if(Notification.permission==='granted'){ ping('Notifica√ß√µes ativas', 'Voc√™ receber√° lembretes!'); return; }
      Notification.requestPermission().then(res=>{
        if(res==='granted') ping('Ativado', 'Pronto! Vamos avisar sobre vencimentos.');
      });
    });

    // ===== Semente inicial (se vazio)
    if(products.length===0){
      const today = toISO(new Date());
      const plus = (n)=> toISO(Date.now()+n*MS_PER_DAY);
      save();
    }

    // ===== Render inicial + checagem de alerta
    function checkCritical(){
      const urgent = products.filter(p=> ['near','expired'].includes(statusOf(p)));
      if(urgent.length>0) ping('Aten√ß√£o aos vencimentos', `${urgent.length} produto(s) precisam de aten√ß√£o`);
    }

    render();
    checkCritical();
  </script>
</body>
</html>